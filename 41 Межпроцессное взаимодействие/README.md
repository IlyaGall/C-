# Межпроцессное взаимодействие


## IPC


IPC - inter-process communication
Межпроцессное взаимодействие - механизм , позволяющий процессамобмениваться данными и координировать свои действия. 

Для современных ОС механизмы IPC являются ключевыми, обеспечиваявозможность взаимодействия множества потоков в системе исовместногоиспользования ими ресурсов при необходимости. 

Процессы, вовлеченные в IPC, могут принадлежать как одному приложениютак и совершенно разным программам. IPC может использоваться, каквпределах одной локальной машины, так и в распределенной системе.

IPC нацелен на обеспечение согласованности данных, совместноеиспользование ресурсов и координацию при работе в мультизадачныхсредах

### IPC - механизмы межпроцессного взаимодействия

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/1.JPG)

### IPC - оценка эффективности организации межпроцессного взаимодействия

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/2.JPG)

### PC - варианты взаимодействия

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/3.JPG)


## Socket

### Сокеты, сокеты Беркли
Сокет — программный интерфейс для обеспечения обмена даннымимеждупроцессами. Процессы при таком обмене могут исполнятьсякакнаоднойЭВМ, так и на различных ЭВМ, связанных между собой толькосетью. 

Сокет — абстрактный объект, представляющий конечнуюточкусоединения.Следует различать клиентские и серверные сокеты. Сокеты были впервые разработаны в КалифорнийскомуниверситетеБерклив 80-х годах 20-го века, отсюда получили название сокетыБеркли. Соответствуют POSIX стандартам.

### TCP и UDP сокеты

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/4.JPG)

### Многопоточный блокирующий сервер

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/5.JPG)

### Однопоточный неблокирующий сервер

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/6.JPG)

### Паттерн реактор

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/7.JPG)

## Жизненный цикл TCP сокета RFC 793


![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/8.JPG)

## Именованные и неименованные каналы

Канал — это абстракция ОС, канал данных, который используетсядляодносторонней или двусторонней связи между процессами. 

Каналы бывают двух видов: 
* Анонимный канал - используются для связи между связаннымипроцессами (т. е. родительским и дочерним). 
* Именованный канал - используются для связи между несвязаннымипроцессами, даже на разных машинах. 

Именованные каналы доступны по имени в файловой системе. Поддерживают архитектуру клиент-сервер, где один процессдействуеткак сервер (создавая канал), а другие действуют как клиенты(подключаясь к каналу). 

Именованные каналы могут работать локально или по сети.

### Неименованный канал

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/9.JPG)


### Именованный канал

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/10.JPG)


### Основные различия между именованными и неименованными каналами

| Характеристика | Неименованные каналы | Именованные каналы |
|-------------|--------------|-------|
| Связь | Между родительским и дочерним процессами | Между любыми процессами |
| Доступ | Доступен только для родственных процессов | Доступен для любых процессов (локально и через сеть) |
| Направленность | Обычно однонаправленные | Могут быть двунаправленными |
| Постоянство | Временные, удаляются по завершению процесса | Постоянные, могут сохраняться в системе |
| Использование через сеть| Только локально | Локально и через сеть |


## RPC

Удаленный вызов процедур (RPC) — один из методов построенияраспределенных клиент-серверных приложений . Он основаннарасширенииобычного локального вызова процедур, так что вызываемая процедуранеобязательно должна находиться в том же адресном пространстве, чтоивызывающая процедура . Два процесса могут находиться в однойсистемеили в разных системах, соединенных сетью.

### RPC

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/11.JPG)


## WCF основные возможности
● Поддержка разных типов связи: WCF поддерживает множество протоколов, такихкакHTTP, TCP, MSMQ, WebSockets и Named Pipes, что позволяет реализовать гибкие решениядлясвязимежду приложениями. 
● SOAP и REST: WCF поддерживает как SOAP (формат для создания веб-сервисов), такиRESTful службы. SOAP более формальный и строго типизированный, в то время какRESTпредпочтителен для простых веб-сервисов. 
● Безопасность: WCF предлагает встроенные механизмы для обеспечения безопасности, такиекак аутентификация, авторизация, шифрование и управление сертификатами. 
● Обмен сообщениями: Поддержка различных шаблонов взаимодействия, таких как"одинкодному", "один ко многим" и двусторонние обмены сообщениями. 
● Транзакции: WCF поддерживает распределённые транзакции, что важно для обеспеченияцелостности данных в сложных системах. 
● Расширяемость: Фреймворк WCF разработан с учётом возможности кастомизации. Разработчики могут расширять или изменять стандартные поведения WCF, добавляясвоиобработчики сообщений, расширяя протоколы безопасности или изменяя способобработкиошибок.


### WCF основные компоненты
● Service: Служба WCF, которая предоставляет определённыйнаборфункций, размещенная по определенному адресу . Address 
● Client: Клиент, который обращается к сервису для выполненияопераций. 
● Binding: Определяет способ, которым клиент и служба взаимодействуют друг с другом (протоколы, формат сообщений). 
● Contract: Описывает, какие операции поддерживает служба(контрактоперации), и формат передаваемых данных (контракт данных). 
● Hosting: Служба WCF может быть размещена в различных окружениях,таких как IIS, Windows-сервисы или любое консольное приложение.

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/12.JPG)

### gRPC основные особенности
● HTTP/2: Использует HTTP/2 для передачи данных, что обеспечивает такиевозможности, как мультиплексирование (одновременные запросы), сжатиезаголовков и эффективное управление соединениями.
● Protocol Buffers (Protobuf): Протокол сериализации данных, который позволяетпередавать данные в компактном бинарном формате. Это быстрее и эффективнее, чем текстовые форматы, такие как JSON или XML.
● Двустороннее потоковое взаимодействие: Поддерживает разные типывызовов—односторонние и двусторонние потоки, что позволяет клиенту и серверу
одновременно обмениваться данными.
● Межъязыковая поддержка: gRPC поддерживает множество языков
программирования, включая Python, Go, Java, C#, Node.js и многие другие.
● Идентификация служб: gRPC использует строгое разделение сервисов иметодовчерез файл .proto, где определяются интерфейсы (методы) и структурыданных.


### gRPC как работает
● Определение контракта (gRPC-сервиса): Вначале создается файл .proto, гдеопределяются все методы и типы данных, которые будут использоватьсядлякоммуникации между клиентом и сервером.
● Генерация кода: Из файла .proto автоматически генерируются серверные иклиентские библиотеки для работы с gRPC в выбранных языках программирования.
● Клиент и сервер: Сервер реализует методы, описанные в контракте,а клиентвызывает эти методы через gRPC.
● Сериализация и десериализация: Все данные, передаваемые между клиентомисервером, сериализуются в компактный бинарный формат с помощьюProtocol Buffers.

![img](https://github.com/IlyaGall/C-/blob/main/41%20%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5/IMG/13.JPG)


### Список материалов для изучения
1. Рихтер Дж. "CLR via C#. Программирование на платформе Microsoft.NET Framework 4.5 на языке C#" 2. https://ru.wikipedia.org/wiki/%D0%A1%D0%BE%D0%BA%D0%B5%D1%82_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D1%8B%D0%B9_%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81) - сокеты3. https://ru.wikipedia.org/wiki/%D0%A1%D0%BE%D0%BA%D0%B5%D1%82%D1%8B_%D0%91%D0%B5%D1%80%D0%BA%D0%BB%D0%B8#bind() - сокеты беркли
4. https://stackoverflow.com/questions/25338862/why-time-wait-state-need-to-be-2msl-long
5. https://server-gu.ru/tcp-syn/
6. https://en.wikipedia.org/wiki/Maximum_segment_lifetime
7. https://ru.wikipedia.org/wiki/POSIX - Posix стандарт
8. https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B0%D0%BA%D1%82%D0%BE%D1%80_(%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD_%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)-шаблон реактор
9. https://inventos.ru/tpost/pyogrkbmf1-kogda-tcp-soketi-otkazivayutsya-umirat задержки по ответам при потеряхпакетов10. https://xvpn.io/blog/tcp-vs-udp tcp vs udp socket
11. https://www.guru99.com/tcp-3-way-handshake.html
12. https://flylib.com/books/en/3.223.1.188/1/ socket lifecycle
13. https://metanit.com/sharp/net/1.1.php
14. https://ru.wikipedia.org/wiki/%D0%98%D0%BC%D0%B5%D0%BD%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BA%D0%B0%D0%BD%D0%B0%D0%BB - именованные каналы
15. https://www.geeksforgeeks.org/remote-procedure-call-rpc-in-operating-system/ RPC
16. https://www.f5.com/company/blog/nginx/building-microservices-inter-process-communication
17. https://ru.wikipedia.org/wiki/SOAP
18. https://chsakell.com/2015/10/15/wcf-proxies-from-beginner-to-expert/ wcf
19. https://www.youtube.com/watch?app=desktop&v=gnchfOojMk4&ab_channel=ByteByteGo Grpc 20. https://gitlab.com/otus-demo/ipc 21. https://gitlab.com/otus-demo/grpc1








