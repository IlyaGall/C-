# Базы данных: NoSQL базы и их особенности

## От реляционных СУБД к NoSQL СУБД

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/1.JPG)

### Интересные факты о термине NoSQL

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/2.JPG)

### Сравнение SQL и NoSQL СУБД


| Описание | SQL | NoSQL |
| -------- | --- | ----- |
| CУБД | реляционная | не-реляционная или распределенная |
| Схема данных | Зафиксированная или статическая предопределенная | динамическая |
| Хранилище данных | БД не ориентирована на иерархическое, распределенное хранилище данных | БД ориентированы на иерархическое, распределенное хранилище данных |
| Масштабируемость | вертикальная | горизонтальная |
| Принципы построения | ACID | BASE |

### ACID принципы в транзакционной системе
* Atomicity - атомарность транзакций
* Consistency - согласованность данных базы после завершения транзакций
* Isolation - изолированность транзакций
* Durability - долговечность данных, независимо от внутренних или внешних сбоев

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/3.JPG)

### BASE принципы работы NoSQL СУБД
* **Basically available** - базовая доступность - каждый запрос гарантированно завершается (успешно или безуспешно)
* **Soft state** - гибкое состояние - состояние системы может меняться с течением времени, даже без ввода новых данных
* **Eventually consistent** - данные могут быть некоторое время рассогласованы, но приходят к согласованному состоянию через некоторое конечное время

### книги

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/4.JPG)

* Martin Fowler “NoSQL Distilled: A Brief Guide to the Emerging World of Polyglot Persistence”
* Eric Evans “Domain Driven Design”


### Паттерн “Агрегат” 

Совокупность взаимосвязанных объектов, которые мы воспринимаем как единое целое с точки зрения изменения данных, называется АГРЕГАТОМ (AGGREGATE). У каждого АГРЕГАТА есть корневой объект и есть граница. Граница определяет, что находится внутри АГРЕГАТА. Корневой объект - это один конкретный объект - СУЩНОСТЬ (ENTITY), содержащийся в АГРЕГАТЕ. Корневой объект - единственный член АГРЕГАТА, на который могут ссылаться внешние объекты, в то время как объекты, заключенные внутри границы, могут ссылаться друг на друга как угодно. СУЩНОСТИ, отличные от корневого объекта, локально индивидуальны, но различаться они должны только в пределах АГРЕГАТА, поскольку никакие внешние объекты все равно не могут их видеть вне контекста корневой СУЩНОСТИ

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/5.JPG)


### Паттерн “Агрегат”

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/6.JPG)

* Единая сущность в доменной модели
* Поиск данных по ключу (возможно через индекс)
* Единица хранения данных
* Простота ORM

### CAP теорема Эрика Брюера
Эвристическое утверждение о том, что в любой реализации распределённых вычислений возможно обеспечить не более двух из трёх следующих свойств:
* согласованность данных (consistency) — во всех вычислительных узлах в один момент времени данные не противоречат друг другу
* доступность (availability) — любой запрос к распределённой системе завершается корректным откликом, однако без гарантии, что ответы всех узлов системы совпадают
* устойчивость к разделению ( partition tolerance) — расщепление распределённой системы на несколько изолированных секций не приводит к некорректности отклика от каждой из секций.

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/7.JPG)

### CAP теорема Эрика Брюера

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/8.JPG)

### PACELC теорема - расширение CAP теоремы

В случае разделения сети (P) в распределенной компьютерной системе необходимо выбирать между доступностью (A) и согласованностью (C) (согласно теореме CAP), но в любом случае, даже если система работает нормально в отсутствии разделения (E), нужно выбирать между :
* задержками (Latency)
* согласованностью (Consistency)

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/9.JPG)

### Фрагментация

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/10.JPG)

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/11.JPG)

### Репликаøии
* репликаøиā основной копии или ведуûийведомýй

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/12.JPG)

* одноранговаā или симметриùнаā репликаøиā

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/13.JPG)

### CRUD операøии на SQL и NoSQL СУБД

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/14.JPG)

### Типý NoSQL СУБД
● КлĀù - знаùение
● Документо-ориентированнýе
● Графовýе
● Колоноùнýе

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/15.JPG)


### Типý NoSQL СУБД : КлĀù - знаùение

КлĀù-знаùение – под каждýм клĀùом ùто-то лежит, пока не запросим – не узнаем ùто именно 

● Redis
● DynamoDB
● Memcached

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/16.JPG)


### Типý NoSQL СУБД : Документно-ориентированнаā

Документно-ориентированнаā БД - аналог клĀù-знаùение, но в каùестве знаùений исполþзуетсā обüектý в определенном формате (JSON, XML):
● Одиноùнýе операøии в CRUD вýполнāĀтсā гораздо бýстрее
● Можно делатþ запросý к содержимому записи, не извлекаā даннýх øеликом
(сходство с RDBMS)


● MongoDB
● LiteDB
● CouchDB
● Elasticsearch

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/17.JPG)

### Типý NoSQL СУБД : Графовýе БД

Графовýе БД – единиøý хранениā: Узлý и ребра(свāзи). Запрос – обход даннýх от узла к узлу по ребрам на заданнуĀ глубину. ИсполþзуĀтсā длā хранениā, управлениā, составлениā запросов к сложнýм тесно взаимосвāзаннýм группам даннýх (соøиалþнýе сети, сервисý рекомендаøий, графý знаùений, логистика, геоинформаøионнýе системý).

● Neo4j
● OrientDb
● Titan

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/18.JPG)

### Типý NoSQL СУБД : Колоноùнýе БД

Колоноùнýе базý даннýх – даннýе хранāтсā в āùейках, сгруппированнýх в колонки ПрименāĀтсā в веб-индексировании, рекламе, телекоммуникаøиāх, аналитиùеских система и т.п.

● Cassandra
● Hbase
● Google BigTable

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/19.JPG)

### NoSQL СУБД : дополнителþнаā информаøиā

[NoSQL Database](https://hostingdata.co.uk/nosql-database/)

[популярность бд](https://db-engines.com/en/ranking)

### NoSQL СУБД : как наùатþ исполþзоватþ

● Установитþ локалþно
● Поднāтþ локалþно в контейнере (Docker)
● Исполþзоватþ облаùнýй сервис 

## Redis


Redis
● КлĀù-знаùение
● Хранит даннýе в оперативной памāти, при необходимости может сохранāтþ даннýе на диске
● Доступ по обûему паролĀ или без него
● Без клĀùа даннýе не полуùитþ
● https://hub.docker.com/u/redis - офиøалþнýй образ Docker
● https://hub.docker.com/r/redis/redis-stack
● Хранилиûе структурированнýх даннýх
● Работа с разлиùнýми типами даннýх
● Обýùно исполþзуетсā как кÿú но может исполþзоватþсā как полноøенное хранилиûе длā неболþúих проектов или брокер оùередей
● Отлиùно документированнаā СУБД
● Поддерживает úирокий спектр āзýков программированиā

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/20.JPG)

### Redis -кÿúирование

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/21.JPG)


### Redis - брокер оùередей

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/22.JPG)

### MongoDB

● Популāрнаā документо-ориентированнаā БД
● Хранение даннýе в формате BSON
● Исполþзование JavaScript длā написаниā функøий и запросов
● Возможностþ вýполнениā операøий, аналогиùнýх операøиāм в релāøионнýх СУБД
● Поддержка хранимýх проøедур на JavaScript
● Валидаøиā полей документов
● Возможностþ репликаøии
● Встроеннаā работа с гео-координатами
● Хороúо документированнаā СУБД
● Поддерживает úирокий спектр āзýков программированиā
● https://hub.docker.com/_/mongo
● https://www.mongodb.com/docs/drivers/csharp/current/

### MongoDB схема даннýх

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/23.JPG)

### MongoDB - операøиā вýборка


![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/24.JPG)

### MongoDB - паттерн Map Reduce - пайплайнý аггрегаøии

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/25.JPG)

### MongoDB код С#
![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/26.JPG)

### MongoDB - úардирование

![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/27.JPG)

### MongoDB - репликаøиā



http://thesecretlivesofdata.com/raft/ - наглāднаā иллĀстраøиā алгоритма репликаøии даннýх между нодами в распределенной системе(исполþзуетсā в MongoDB) https://www.mongodb.com/docs/manual/replication/

### LiteDB

● Документо-ориентированнаā
● Standalone СУБД, не требует установки и конфигурированиā
● Легковеснаā
● Позволāет бýстро наùатþ работатþ с документо-ориентированнýм хранилиûем
● https://www.litedb.org/

### Cassandra

● Колонко-ориентированное хранилиûе
● Не релāøионнаā отказоустойùиваā распределеннаā СУБД
● Гибридное NoSQL реúение , соùетает моделþ хранениā на основе столбøов с моделþĀ key-value
● Рассùитана на создание крупномасúтабнýх надежнýх хранилиû, представленнýх в виде хеú
● Разработана на Java в 2008 году
● Наиболее удобнаā база даннýх длā кластеризаøии
● Единственнаā база даннýх, где скоростþ записи вýúе скорости ùтениā (около 80-360 МБ/с на узел)

### Cassandra - моделþ даннýх
● Столбеø или колонка (column) – āùейка с даннýми, вклĀùаĀûаā 3 ùасти: имā (column name)
в виде массива байтов, метку времени (timestamp) и само знаùение (value) также в виде байтового массива;
● Строка или записþ (row) – именованнаā коллекøиā столбøов;
● Семейство столбøов (column family) – именованнаā коллекøиā строк;
● Пространство клĀùей (keyspace) – группа из несколþких семейств столбøов, собраннýх вместе.



![img](https://github.com/IlyaGall/C-/blob/main/34%20%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20NoSQL%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B8%20%D0%B8%D1%85%20%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8/IMG/29.JPG)








